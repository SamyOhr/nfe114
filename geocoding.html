<!DOCTYPE html>
<html>
<head>
    <title>Geocodage</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
</head>
<body>
    <h2>Geocodage</h2>

    <form id="form">
        <label for="address">Entrez une adresse :</label>
        <input type="text" id="address" name="address">
        <input type="submit" value="Rechercher">
    </form>

    <div id="map" style="width:100%; height:500px;"></div>

    <script>
        // Création de la couche OpenStreetMap
        var osmLayer = new ol.layer.Tile({
            source: new ol.source.OSM()
        });

        // Création de la carte
        var map = new ol.Map({
            target: 'map',
            layers: [osmLayer],
            view: new ol.View({
                center: ol.proj.fromLonLat([5.36978, 43.296482]), // Centre sur votre POI initial
                zoom: 15 // Zoom de la carte
            })
        });

        // Fonction qui positionne le POI initial sur la carte
        function positionnerPOI(lon, lat) {
            var iconFeature = new ol.Feature({
                geometry: new ol.geom.Point(ol.proj.fromLonLat([lon, lat])),
                name: 'POI'
            });

            var iconStyle = new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 46],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    src: 'Ol_icon_blue_example.png' // Chemin vers l'icône du POI initial
                })
            });

            iconFeature.setStyle(iconStyle);

            var vectorSource = new ol.source.Vector({
                features: [iconFeature]
            });

            var vectorLayer = new ol.layer.Vector({
                source: vectorSource
            });

            map.addLayer(vectorLayer);
        }

        // Événement pour soumettre le formulaire
        document.getElementById('form').addEventListener('submit', function (event) {
            event.preventDefault(); // Empêche la soumission du formulaire
            var address = document.getElementById('address').value; // Récupère la valeur du champ adresse
            var url = 'https://nominatim.openstreetmap.org/search?q=' + address + '&format=json&polygon=1&addressdetails=1'; // URL pour le service de géocodage
            fetch(url)
                .then(function (response) {
                    return response.json();
                })
                .then(function (json) {
                    var lon = parseFloat(json[0].lon); // Récupère la longitude de la première réponse
                    var lat = parseFloat(json[0].lat); // Récupère la latitude de la première réponse
                    map.getView().setCenter(ol.proj.fromLonLat([lon, lat])); // Centre la carte sur les coordonnées de la réponse
                    positionnerPOI(lon, lat); // Positionne le POI initial sur la carte
                });
        });

       // Déclaration de l'icône du POI initial
var iconStyle = new ol.style.Style({
    image: new ol.style.Icon({
        anchor: [0.5, 46],
        anchorXUnits: 'fraction',
        anchorYUnits: 'pixels',
        src: 'Ol_icon_blue_example.png' // Chemin vers l'icône du POI initial
    })
});


